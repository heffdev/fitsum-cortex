spring:
  application:
    name: fitsum-cortex-api
  
  main:
    web-application-type: servlet
  
  autoconfigure:
    exclude:
      - org.springframework.ai.autoconfigure.ollama.OllamaAutoConfiguration
      - org.springframework.ai.autoconfigure.transformers.TransformersAutoConfiguration

  datasource:
    url: jdbc:postgresql://localhost:5432/cortex_dev
    username: postgres
    password: postgres
    driver-class-name: org.postgresql.Driver

  flyway:
    enabled: true
    baseline-on-migrate: true
    locations: classpath:db/migration

  ai:
    openai:
      base-url: ${OPENAI_BASE_URL:http://localhost:1234}
      api-key: ${OPENAI_API_KEY:lm-studio}
      chat:
        options:
          model: qwen/qwen3-4b-2507
          temperature: 0.1
          timeout: 30s
          max-retries: 2
      embedding:
        options:
          model: text-embedding-bge-large-en-v1.5
          timeout: 300s
          max-retries: 2

    vectorstore:
      pgvector:
        initialize-schema: false
        index-type: IVFFLAT
        distance-type: COSINE_DISTANCE
        dimensions: 1024

server:
  port: 8080

vaadin:
  enabled: false

cortex:
  retrieval:
    max-chunks: 12
    fts-top-k: 25
    ann-top-k: 25
    rerank-top-k: 10
    similarity-threshold: 0.7
    allow-empty-context: false

  sensitivity:
    patterns:
      pii:
        - "\\b\\d{3}-\\d{2}-\\d{4}\\b"  # SSN
        - "\\b[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,}\\b"  # Email
        - "\\b\\d{3}[-.\\s]?\\d{3}[-.\\s]?\\d{4}\\b"  # Phone
      confidential:
        - "\\bconfidential\\b"
        - "\\binternal only\\b"
        - "\\bdo not share\\b"

  ingestion:
    chunk-size-tokens: 380
    chunk-overlap-percent: 15
    batch-size: 50

  security:
    enabled: true
    default-user: demo@fitsum.ai

  observability:
    enabled: false # Temporarily disabled
    export-endpoint: http://localhost:4318

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  prometheus:
    metrics:
      export:
        enabled: false # Temporarily disabled
  tracing:
    enabled: false # Temporarily disabled
    sampling:
      probability: 0.0 # Temporarily disabled

logging:
  level:
    ai.fitsum.cortex: DEBUG
    org.springframework.ai: INFO
    org.flywaydb: INFO